version: 1.0
runtime: docker
build:
  commands:
    build:
      - echo "Building Go application with App Runner"
      - echo "Docker build will handle the actual compilation"
run:
  runtime-version: latest
  command: ./start.sh # Changed to start.sh
  network:
    port: 8080
    env: PORT # This is the port App Runner exposes
  env:
    - name: PORT # This will be the port for app-server
      value: "8080"
    - name: PORT_AUTH_SERVER # New env var for auth-server
      value: "8081"
    - name: AWS_REGION
      value: "ap-northeast-1"
    - name: S3_BUCKET_NAME
      value: "raymond-go-s3-uploader-dev-2025"
    - name: ENVIRONMENT
      value: "production"
    - name: APP_SERVER_URL # Explicitly set for auth-server
      value: "https://fpdevmcqq2.ap-northeast-1.awsapprunner.com"
    - name: REDIRECT_URL # Explicitly set for auth-server
      value: "https://fpdevmcqq2.ap-northeast-1.awsapprunner.com/auth/callback"
